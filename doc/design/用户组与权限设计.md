<!-- ## 默认的用户组

带权限的用户组：学生（普通用户），助教，老师
老师设置助教，助教管理学生

不带权限的用户组：用于统计/批改的学生分组

超级管理员不算用户组，通过后台操作进行管理，比如可以设置老师账号 -->

## 关于权限的说明

权限控制的角色只有两种：普通用户和管理员。

权限控制的客体包括两类：
- 与具体用户相联系的，个人信息、密码、所属组、提交记录。
- 不与具体用户相联系的，用户组本身、题目。

对于与具体用户相联系的，每个用户对自己一般都有权限（修改提交记录除外）；控制的主要是对其他人的权限。

<!-- 我暂时没有设置量化的权限，比如可以修改等级比自己低的而不能修改等级比自己高的，那样太复杂了…… -->

权限是最基本的，比如获取某个学生属于哪些组的信息，从这个权限出发可以实现获取某个组所有学生的名单，但后者就不会作为权限写进去（当然接口是会提供的）。

## 用户组权限

|权限 | 英文名（暂定） | 备注 | 学生 | 助教|
|--- | --- | --- | --- | --- |
|获取其他人信息 | `GET_OTHERS_INFO` | 可以获取其他人的个人信息，如账号名、邮箱 | √ | √|
|修改其他人信息 | `SET_OTHERS_INFO` | 可以修改其他人的个人信息 | | √|
|重置其他人密码 | `RESET_OTHERS_PASSWORD` | 可以重置其他人的密码 *（指定密码还是怎么重置？）* | √|
|获取题目 | `GET_PROBLEM` | 可以在满足获取要求的前提（题目对某组可见、题目有可见日期等）下获取题目的内容、该题统计信息 | √ | √|
|获取任何题目 | `GET_PROBLEM_COMPLETE` | 可以获取任何题目的内容、该题统计信息 | | √|
|设置题目 | `SET_PROBLEM` | 可以添加/删除题目、修改题目内容 | | √|
|获取其他人提交记录 | `GET_OTHERS_SUBMISSION` | 可以（在对应题目可见的前提下）获取其他人的提交记录，包括题目、时间、结果，但不可以获取代码；进而可以获取某道题的提交记录列表 | √ | √|
|获取其他人任何完整的提交记录 | `GET_OTHERS_SUBMISSION_COMPLETE` | 可以获取其他人的提交记录，包括题目、时间、结果、代码 | | √|
|修改任何人提交记录 | `SET_ANY_SUBMISSION` | 可以修改所有人的提交记录，包括删除、重判、人为指定分数 | | √|
<!-- |获取其他人所属组 | `GET_OTHERS_BELONGING` | 可以获取用户属于哪些组，进而可以获取某组的学生名单等 | √ *(?)* | √|
|修改其他人所属组 | `SET_OTHERS_BELONGING` | 可以设置用户所属的组，进而可以将学生从某个组里添加/删除 | | √|
|修改组 | `SET_GROUP` | 可以对用户组进行创建、删除、更名 | | √|
|设置组的权限 | `SET_GROUP_AUTHORITY` | 可以设置组的权限 | | √| -->

*对于能否提交某道题目的权限，我目前考虑是最好设定能够看到这道题就可以提交，然后要设置ddl的话可以在数据处理的时候标记/过滤过期的提交，而不是禁止学生提交，这样一方面学生可以自己练习，一方面也方便权限设置。*

*workspace相关的事情还没确定，所以相关权限也还没考虑。*

<!-- ## 权限管理流程

我也考虑了用户如何通过前端与管理系统交互，这些内容可能整理之后会写进用户故事里。

### 用户组管理流程

首先自带三个基本组：普通用户、助教、老师。这三个组的权限默认设置好。（是否需要限定这三个组不可更改？）

超级管理员在后台添加老师的账号，老师可以通过前端登录并打开前端的管理界面。
老师自带修改所属组权限，可以添加助教的账号。

学生自行注册，并且自带学生权限。

老师/助教在前端管理界面可以查看所有用户的列表，列表包含了学生的信息。
列表可以过滤用户组，从而可以获得某个组的学生列表。

老师/助教也可以查看有哪些用户组，然后助教可以新建不带权限的用户组，通过导入功能（[可以参考这个文档所提到的内容](../research/对于OnlineJudge用户管理的调研.md)）将学生导入用户组。
*（这里有细节问题，加入用户组是否要要求学生已经建好账号还是可以导入的同时创建账号？）*

老师/助教也可以回到所有用户列表，并在这里过滤用户组，从而得到每个用户组的学生名单，然后对单个学生进行操作。

*（是否要再添加复杂的功能，例如批量操作？这些应该属于前端的事情，可能需要讨论）*

### 题目与提交管理流程

老师/助教都可以新建或是修改题目，这会在题目界面中完成。

然后学生（满足题目可见性条件后）可以看见题目，从而可以提交；学生可以查看自己提交的详细记录，也可以查看某道题的所有提交的粗略记录，老师/助教也可以查看每个学生的详细提交。
题目会有一些自带的统计信息，比如有多少人通过、通过/不通过提交占比等等，这些信息不涉及个人，对所有能看到这题的用户都开放。

老师/助教可以在题目界面获取每道题的具体统计列表，包括每个这题的所有提交，点进去也可以看到这个提交的详细信息。
老师/助教也可以查看这道题的按用户统计列表，每个用户显示最高分的提交项，然后附上用户的其他信息（包括用户组），所以可以按照用户组查看每个学生的分数。

出现特殊情况时，老师/助教可以对学生的提交进行删除、重判、人为指定分数。

*（是否要在前端管理界面同样提供这样的功能，而不是在题目界面去看？是否要提供导出用户分数？）* -->

## 权限的实现

目前是考虑自己写一个`User`的model，其中有个字段控制是普通用户还是管理员。

然后为不同的接口编写相应的DRF的Permissions，在其中判断用户是否有权限（通常的模式是，管理员一律放行，普通用户则检查与对象的所属关系）。
